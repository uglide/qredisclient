language: cpp
sudo: required
dist: xenial
compiler:
  - gcc
addons:
  apt:
    sources:
      - ppa:ppa:beineri/opt-qt597-xenial      
    packages:
      - qt59
install:
- sudo apt-key update
- sudo apt-get update -qq
- sudo apt-get install gdb lcov valgrind libssl1.0.0 python3 python-virtualenv -y -qq
- source /opt/qt59/bin/qt59-env.sh
- gem install coveralls-lcov
- qmake -v
- gcc --version
- gcov --version
script: 
  - pushd ./tests/unit_tests && ./run_tests && popd
  - pushd ./tests/functional && 
    mkdir bin &&
    qmake "DESTDIR=./bin/" && make -s &&
    virtualenv .venv -p python3 &&
    source .venv/bin/activate &&
    pip install -r requirements.txt &&
    python tests.py &&
    popd    
  - qmake && make -s
after_success:
  - coveralls-lcov --repo-token ${COVERALLS_TOKEN} coverage.info.filtered
services:
  - redis-server
